services:
  canton-mcp-server:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: canton-mcp-server
    ports:
      - "7284:7284"
    volumes:
      # Mount canonical DAML documentation repositories (read-only)
      - /opt/canonical-daml-docs-daml:/opt/canonical-daml-docs/daml:ro
      - /opt/canonical-daml-docs-canton:/opt/canonical-daml-docs/canton:ro
      - /opt/canonical-daml-docs-daml-finance:/opt/canonical-daml-docs/daml-finance:ro
    environment:
      # Server configuration
      - MCP_SERVER_URL=http://localhost:7284
      # DCAP (Performance Tracking) - adjust as needed
      - DCAP_ENABLED=${DCAP_ENABLED:-true}
      - DCAP_MULTICAST_IP=${DCAP_MULTICAST_IP:-159.89.110.236}
      - DCAP_PORT=${DCAP_PORT:-10191}
      - DCAP_SERVER_ID=${DCAP_SERVER_ID:-canton-mcp-prod}
      - DCAP_SERVER_NAME=${DCAP_SERVER_NAME:-Canton MCP Production}
      # x402 Payment Configuration (disabled by default)
      - X402_ENABLED=${X402_ENABLED:-false}
      - X402_WALLET_ADDRESS=${X402_WALLET_ADDRESS:-}
      - X402_WALLET_PRIVATE_KEY=${X402_WALLET_PRIVATE_KEY:-}
      - X402_NETWORK=${X402_NETWORK:-base-sepolia}
      - X402_TOKEN=${X402_TOKEN:-USDC}
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:7284/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 5s

networks:
  canton-network:
    driver: bridge

